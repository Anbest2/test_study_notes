# 集群简介

redis中将多台服务器结合在一起，这个整体叫做集群，单个服务器叫做节点。这样实现压力分担和水平扩容。  

# 代理主机

代理服务器作为集群的唯一入口，但是当代理服务器挂掉，集群功能就失效。可用性差

# 无中心化集群配置

任何一台服务器都可以作为集群入口，他们互相是联通的状态。  

# 什么是slots

一个redis集群中包含16384个插槽，插槽是用来判断某一个键应该分配到哪个节点上。集群建立之初，给每个节点分配插槽范围，redis通过算法计算key映射在哪个范围内，从而判断将数据存储在哪个节点上  

# redis中的一些问题

## 缓存穿透

### 原因

应用服务压力增大，从缓存数据库中查不到数据，不断访问数据库，造成数据库压力过大；命中率过低，客户端不断请求缓存中没有的数据，造成不断应用服务器不断访问数据库造成压力过大，主要原因恶意攻击。总的说就是缓存的功能失效了。    

### 解决方案

空值缓存：当查询的数据不存在时，将这个不存在的值也同步到缓存服务器中，过期时间设置短。

访问白名单：使用bitmaps类型设置个访问白名单，id不在该范围内的不允许访问  

布隆过滤器：  

## 缓存击穿

### 原因：

某个热门访问的key过期了，但此时大量访问需要用到这个key，造成数据库压力过大。  

### 解决方案

把一些热门数据提前存入到redis中，加大热门key的时长。  

实时调整：现场监控哪些key热门，现场调整过期时长。  

使用锁：就是当别的线程已经在同步缓存时，其他数据要睡眠一段时间再查询。  

## 雪崩问题

### 原因：

  极少时间内查询大量key集中过期，造成数据库应用程序压力过大，数据库瘫痪。  

### 方案  ：

采用多级缓存结构  。

使用锁和队列的机制不使用高并发的情况。  

设置过期标志，更新缓存：缓存快要过期时，提前更新数据  

将缓存失效时间分散开  

## 分布式锁

原先的锁的机制只能在单个节点中生效，当引入集群后就会有问题。所以设立一个锁对所有机器都生效。  

### 实现方式

在redis中有个setnx命令。通过setnx创建后的key，其他操作没办法对key值进行修改。

### 问题

如果不释放这个key永远不能操作。   

### 解决：设置过期时间

setnx key value  

expire key second 设置过期时间 --》这样分俩步不是原子操作，可能过期时间没有设置成功-》解决set key value nx ex second


