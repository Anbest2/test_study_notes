# Q1：redis单线程为啥会有事务冲突

这里的冲突主要指事务冲突。事务执行时分为排队和执行俩个步骤，排队时就已经读取了数据，如果多个事务一起对同一个数据进行操作，虽然单线程任然可能会出现某个事务取到的是历史数据。

# redis事务概述

## redis中事务是什么？通过什么过程实现的

redis中事务就是将多个操作命令进行组队，然后一起执行，执行过程中不会被其他命令插队。通过Multi，Exec, discad。其中Multi是进行组队，Exec是顺序执行队伍中的所有命令。discard是在组队时取消组队。  

## 在组队阶段redis发现命令有异常，和在执行时命令报错，是如何处理的？

组队阶段发现命令异常时，在执行阶段队伍中的所有命令都不执行；而在执行阶段命令报错，队列中只有报错的命令不执行，其他命令继续执行。  

# redis中的事务冲突

## 何为事务冲突？

redis在对数据修改时，先读数据，然后计算再写入。但是当多个人同时进行写操作时，他们会取一个相同数据，然后分别计算最后一起写入。与按照顺序一个一个进行读写的期望不符。  

## 解决方案--悲观和乐观锁  

### 悲观锁

就是操作前上锁，其他人操作不了，操作后解锁。

### 乐观锁

数据中加入版本号，每次写入成功后，数据库中数据版本号就会更新。每次进行写入之前都对比读取数据时的版本号和写入数据时的版本号，一样可以写入，不一样重新读取计算。  

## 如何使用呢？

用watch key 进行监视key的变化。 在执行时如果key被修改过，则执行失败。












