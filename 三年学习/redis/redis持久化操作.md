# redis持久化简介

redis数据库中的数据一般是保存在内存中，一但断电，数据无法恢复。redis的持久化是指redis从硬盘中读写数据。只要有俩种方式，RDB和AOF。  

# RDB

## 写时复制技术

 redis中会启用一个子进程forks(),将内存中的数据集保存到一个临时区域，然后整体替换硬盘中的*.rdb文件。 

## 为什么要先保存在临时区域整体替换而不是直接往rdb文件中写数据呢？

因为一这样会造成数据丢失。  

## RDB备份

redis中内存数据丢失后只需要重新启动redis，启动时redis会自动寻找配置路径下的rdb文件，进行数据恢复  

# AOF

将所有的写命令，以日志的形式保存在aof文件中，重启redis时会从aof文件中读取指令，然后执行进行数据恢复。当rdb和aof同时启动时，redis默认从aof文件中恢复数据。  

## AOF文件损坏恢复

/bin/redis-check-aof--fix *.aof  

## 重新压缩操作

当aof文件越来越大时，redis会将多条指令合并为一条，这个过程叫重写压缩操作。过程就是把rdb快照以二进制的形式附在新aof头部，作为已有的历史数据，替换原来流水账的操作。也是用fork子进程操作。






